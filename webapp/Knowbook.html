<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta charset="UTF-8">
    <title>动态表格</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 95vh;
            margin: 0;
            padding-top: 20px;
            padding-bottom: 20px;  /* 预留出底部的空间 */
            background-color: #2d2d2d;
            color: white;
        }

        /* 修改表格大小 */
        #myTable tr {
            height: 40px;
            border-top: none;
            border-bottom: none;
            text-align: left;
        }
        #myTable td:nth-child(1) {
            width: 100px;
        }
        #myTable td:nth-child(2) {
            width: 200px;
        }
        #myTable td:nth-child(3) {
            width: 150px;
        }


        #myTable tr:first-child{
            vertical-align: bottom;
            text-align: left;
            border-bottom: 4px solid white;
            border-top: #2d2d2d;
            height: 30px;
        }

        #myTable tr:last-child{
            border-bottom: #2d2d2d;
        }

        #myTable {
            border: none;
            border-collapse: collapse;
        }
        #myTable td, #myTable th {
            border-left: none;
            border-right: none;
        }

        .buttonPage {
            position: fixed;  /* 将 .buttonPage 定位到视口，这样它就会始终保持在屏幕的相同位置，即使页面滚动 */
            bottom: 20px;  /* 将 .buttonPage 从底部向上移动 20px */
            left: 0;  /* 从左边开始，确保 .buttonPage 占据整个宽度 */
            width: 100%;
            text-align: center;
            padding: 20px 0;
            background-color: #2d2d2d;
        }
        .buttonPage button{
            border-radius: 10px;
            background-color: #2d2d2d;
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .buttonPage button:hover{
            background-color: rgb(128,128,128);
        }

        h1 {
            font-size: 32px;
        }

    </style>
    <script>
        var startIndex=0;

        if (sessionStorage.getItem("know") !== null) {
            startIndex = parseInt(sessionStorage.getItem("know"));
        } else {
            startIndex = 0;
        }

        sessionStorage.setItem("know",startIndex);
        var know = parseInt(sessionStorage.getItem("know")) || 0;
        function nextPage() {
            startIndex += 10;  // 点击"下一页"时，起始索引增加10
            sessionStorage.setItem("know",startIndex);
            know = parseInt(sessionStorage.getItem("know")) || 0;
            updateTable();
        }

        function prevPage() {
            if (startIndex > 0) {
                startIndex -= 10;  // 点击"上一页"时，如果起始索引大于0，则减少10
                sessionStorage.setItem("know",startIndex);
                know = parseInt(sessionStorage.getItem("know")) || 0;
                updateTable();
            }
        }


        function updateTable() {
            var table = document.getElementById("myTable");
            // 清空表格
            for(var i = table.rows.length - 1; i > 0; i--)
            {
                table.deleteRow(i);
            }

            fetch("Familiar/show")
                .then(response => response.json())
                .then(datazone => {
                    var datalist = datazone.dataZone.datalist;

                    for (var i = 0; i < 10; i++) {
                        if (know + i >= datalist.length) {
                            break;  // 如果startIndex + i大于或等于datalist.length，停止添加新的行
                        }
                        if (datalist[know + i] !== null) {
                            var row = table.insertRow(-1);
                            var cell1 = row.insertCell(0);
                            var cell2 = row.insertCell(1);
                            var cell3 = row.insertCell(2);

                            cell1.innerHTML = i+1;
                            cell2.innerHTML = datalist[know + i].word;
                            cell3.innerHTML = '<button data-row-index="' + i + '" onclick="removeWord(\'' + datalist[know + i].word + '\', this)">移除</button>';
                        }
                    }

                    // 如果起始索引为0，禁用"上一页"按钮
                    document.getElementById("prevPage").disabled = (startIndex == 0);
                    // 如果没有更多的数据可以显示，禁用"下一页"按钮
                    document.getElementById("nextPage").disabled = (startIndex + 10 >= datalist.length);
                });
        }

        function removeWord(word, button) {
            fetch('Familiar/remove?word=' + word, {
                method: 'POST',  // 或者其他适合你的后端的HTTP方法
                headers: {
                    'Content-Type': 'application/json'
                },
                // 如果你的后端需要请求体，你可以在这里添加
                // body: JSON.stringify({ word: word })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Success:', data);
                    // 隐藏包含被点击按钮的表格行
                    var rowIndex = button.getAttribute('data-row-index');
                    document.getElementById("myTable").rows[rowIndex + 1].style.display = 'none';
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            button.parentElement.parentElement.style.display = 'none';
        }
    </script>
</head>
<body onload="updateTable();">
<h1 style="position: absolute; top: 10%; font-size: 32px;">熟词本</h1>
<table id="myTable" border="1">
    <tr>
        <th>序号</th>
        <th>单词</th>
        <th></th>
    </tr>
</table>
<div class="buttonPage">
    <button id="prevPage" onclick="prevPage()">上一页</button>
    <button id="nextPage" onclick="nextPage()">下一页</button>
</div>
</body>
</html>