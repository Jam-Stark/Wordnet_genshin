<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>个人主页原</title>
    <style>

        body {
            background-color: #2d2d2d;
            color: #ffc0cb; /* This is a light pink color */
            font-family: Arial, sans-serif;
        }

        #calendar {
            background-color: #333; /* 深灰色背景 */
            color: papayawhip; /* 浅色文字 */
            flex-wrap: wrap;
        }

        /*.dayCell {*/
        /*    width: 14.28%; !* This will give you 7 equal columns *!*/
        /*    border: 1px solid #ffc0cb;*/
        /*    box-sizing: border-box; !* This makes sure the border is included in the width *!*/
        /*    padding: 10px;*/
        /*    display: flex;*/
        /*    justify-content: center;*/
        /*    align-items: center;*/
        /*    border-radius: 100px; !* This will make the corners rounded *!*/
        /*}*/

        #calendar th,
        #calendar td {
            padding: 10px;
            text-align: center;
        }

        #calendar .today {
            color: #fff; /* 当天日期的文字颜色设为白色 */
        }

        h1 {
            text-align: center;
        }

        #avatar {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            margin: 20px auto;
            background-color: lightgray;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

            #avatar img {
                max-width: 100%;
                max-height: 100%;
            }

        #calendar {
            margin-top: 20px;
            border-collapse: collapse;
            width: 100%;
        }

            #calendar th,
            #calendar td {
                border: 1px solid black;
                padding: 10px;
            }

            #calendar th {
                background-color: lightgray;
            }

            #calendar td.today {
                background-color: lightblue;
            }

        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: white;
            margin: 20% auto;
            padding: 20px;
            width: 50%;
        }

        .modal img {
            max-width: 100%;
            max-height: 400px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>个人主页</h1>
        <div id="avatar" style=" cursor:pointer ">
            
        </div>

        <p id="username"></p>

        <table id="calendar">
            <tr>
                <th>日</th>
                <th>一</th>
                <th>二</th>
                <th>三</th>
                <th>四</th>
                <th>五</th>
                <th>六</th>
            </tr>
        </table>
    </div>

  

    <script>
  

         function setAvatar(base64ImageData) {
            var avatarElement = document.getElementById("avatar");
            var avatarImage = document.createElement("img");
            avatarImage.src = 'data:image/jpg;base64,' + base64ImageData;
            avatarImage.alt = "Avatar";
            avatarImage.addEventListener("load", function () {
                var width = avatarImage.width;
                var height = avatarImage.height;

                if (width > height) {
                    avatarImage.style.width = "100%";
                    avatarImage.style.height = "auto";
                } else {
                    avatarImage.style.width = "auto";
                    avatarImage.style.height = "100%";
                }
            });

            avatarElement.innerHTML = "";
            avatarElement.appendChild(avatarImage);
        }


        document.addEventListener("DOMContentLoaded", function (event) {

            var today = new Date();
            var year = today.getFullYear();
            var month = today.getMonth();
            var avatarElement = document.getElementById("avatar");
            avatarElement.addEventListener("click", function () {
                fetch('Calendar/getAllSculpture')
                    .then(response => response.json())
                    .then(avatarList => {
                        var avatarPopup = window.open("", "Avatar Selector", "width=600,height=600");
                        for (var i = 0; i < avatarList.length; i++) {
                            var avatar = avatarList[i];
                            var avatarImage = document.createElement("img");
                            avatarImage.src = 'data:image/jpg;base64,' + avatar.base64ImageData;
                            avatarImage.alt = avatar.fileName;
                            avatarImage.style.cursor = "pointer";
                            avatarImage.addEventListener("click", function () {
                                avatarPopup.close();
                                fetch('Calendar/setSculpture?fname=' + this.alt)
                                    .then(response => {
                                        if (response.ok) {
                                            setAvatar(this.src);
                                        }
                                    });
                            });
                            avatarPopup.document.body.appendChild(avatarImage);
                        }
                    });
            });

            function renderCalendar() {
                var calendarElement = document.getElementById("calendar");

                var firstDayOfMonth = new Date(year, month, 1);
                var lastDayOfMonth = new Date(year, month + 1, 0);
                var firstDayOfWeek = firstDayOfMonth.getDay();
                var daysInMonth = lastDayOfMonth.getDate();

                var days = [];
                for (var i = 0; i < firstDayOfWeek; i++) {
                    days.push("");
                }

                for (var i = 1; i <= daysInMonth; i++) {
                    days.push(i);
                }

                var html = "";
                var monthNames = ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"];
                var monthYearRow = "<tr><th colspan='7'>" + monthNames[month] + " " + year + "</th></tr>";
                var weekDaysRow = "<tr><td>周日</td><td>周一</td><td>周二</td><td>周三</td><td>周四</td><td>周五</td><td>周六</td></tr>";
                html += monthYearRow;
                html += weekDaysRow;

                var row = "<tr>";
                for (var i = 0; i < days.length; i++) {
                    if (i > 0 && i % 7 === 0) {
                        row += "</tr>";
                        html += row;
                        row = "<tr>";
                    }
                    if (days[i] === "") {
                        row += "<td></td>";
                    } else {
                        var className = "";
                        if (
                            year === today.getFullYear() &&
                            month === today.getMonth() &&
                            days[i] === today.getDate()
                        ) {
                            className = "today";
                        }
                        row += "<td class='" + className + "' id='day" + days[i] + "'>" + days[i] + "</td>";
                    }
                }
                row += "</tr>";
                html += row;

                calendarElement.innerHTML = html;
            }

            renderCalendar();

            fetch('Users/information')
                .then(response => response.json())
                .then(data => {
                    setAvatar(data.sculpture.base64ImageData);
                   

                    

                    var calendarItems = data.calendarList;
                    for (var i = 0; i < calendarItems.length; i++) {
                        var date = new Date(calendarItems[i].date);
                        if (date.getMonth() === month && date.getFullYear() === year) {
                            var dayCell = document.getElementById('day' + date.getDate());
                            dayCell.className = "dayCell";
                            if (calendarItems[i].medal) {
                                var medals = {
                                    'Gold': '🥇',
                                    'Silver': '🥈',
                                    'Bronze': '🥉'
                                };
                                dayCell.innerHTML += " " + medals[calendarItems[i].medal];
                            }
                            else if (calendarItems[i].completed) {
                                dayCell.innerHTML += " ✔️";
                            }
                            else {
                                dayCell.innerHTML += " ❌";
                            }
                        }
                    }
                })
                .catch(error => console.error('Error:', error));
        });
    </script>
</body>

</html>